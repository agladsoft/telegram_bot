# 🤖 Telegram Bot - Система мониторинга сервисов

## 📖 Описание проекта

Telegram бот для мониторинга и управления различными сервисами и системами. Бот предоставляет удобный интерфейс для проверки состояния баз данных, балансов, логов контейнеров и системной статистики.

## 🚀 Функциональность

### 🔍 Основные возможности

- **🗄️ Мониторинг базы данных**: Проверка подключения к ClickHouse
- **💰 Финансовый мониторинг**: Отслеживание баланса Яндекс.Кошелька через XML River API
- **🔌 API мониторинг**: Проверка оставшихся запросов в сервисе Dadata
- **💻 Системный мониторинг**: Статистика CPU, RAM и дискового пространства
- **🐳 Docker управление**: Просмотр логов контейнеров
- **📊 Аналитика**: Подсчет компаний с унифицированными названиями

### 🎯 Целевая аудитория

Бот предназначен для системных администраторов, DevOps-инженеров и разработчиков, которым необходимо оперативно получать информацию о состоянии различных сервисов и инфраструктуры.

## 🏗️ Архитектура

### 📁 Структура проекта

```
telegram_bot/
├── 🐍 main.py              # Основной файл бота с логикой
├── ⚙️ __init__.py          # Конфигурация и вспомогательные функции
├── 📦 requirements.txt     # Python зависимости
├── 🐳 Dockerfile          # Docker образ
├── 🚀 docker-compose.yml  # Docker Compose конфигурация
└── 📚 README.md           # Документация
```

### 🛠️ Технологический стек

- **🐍 Python 3.8+** - основной язык программирования
- **🤖 pyTelegramBotAPI** - библиотека для работы с Telegram Bot API
- **🐳 Docker** - контейнеризация приложения
- **🗄️ ClickHouse** - база данных для аналитики
- **🔌 Dadata API** - сервис для работы с данными компаний
- **💰 XML River API** - интеграция с Яндекс.Кошельком
- **💻 psutil** - системный мониторинг
- **🐳 docker-py** - управление Docker контейнерами

## ⚙️ Установка и настройка

### 📋 Предварительные требования

- 🐍 Python 3.8 или выше
- 🐳 Docker и Docker Compose
- 🤖 Telegram Bot Token (получить у @BotFather)
- 🗄️ Доступ к ClickHouse базе данных
- 🔑 API ключи для Dadata и XML River

### 🔑 Переменные окружения

Создайте файл `.env` в корневой директории проекта:

```bash
# 🤖 Telegram Bot Token
TOKEN=your_telegram_bot_token_here

# 🗄️ ClickHouse Database
HOST=your_clickhouse_host
DATABASE=your_database_name
USERNAME_DB=your_username
PASSWORD=your_password

# 🔧 Другие переменные (опционально)
```

### 🐳 Запуск через Docker (рекомендуется)

1. **📥 Клонирование репозитория**
   ```bash
   git clone <repository-url>
   cd telegram_bot
   ```

2. **⚙️ Настройка переменных окружения**
   ```bash
   cp .env.example .env
   # Отредактируйте .env файл с вашими данными
   ```

3. **🔨 Сборка и запуск**
   ```bash
   docker-compose up --build -d
   ```

4. **✅ Проверка статуса**
   ```bash
   docker-compose ps
   docker-compose logs telegram_bot
   ```

### 🐍 Локальная установка

1. **🌿 Создание виртуального окружения**
   ```bash
   python3 -m venv venv
   source venv/bin/activate  # Linux/Mac
   # или
   venv\Scripts\activate     # Windows
   ```

2. **📦 Установка зависимостей**
   ```bash
   pip install -r requirements.txt
   ```

3. **⚙️ Настройка переменных окружения**
   ```bash
   export TOKEN="your_telegram_bot_token"
   export HOST="your_clickhouse_host"
   export DATABASE="your_database_name"
   export USERNAME_DB="your_username"
   export PASSWORD="your_password"
   ```

4. **🚀 Запуск бота**
   ```bash
   python main.py
   ```

## 📱 Использование

### 🚀 Команды бота

- `/start` - 🏠 главное меню
- `/check_connect_db` - 🗄️ проверка подключения к базе данных
- `/check_balance_xml_river` - 💰 проверка баланса Яндекс.Кошелька
- `/check_num_requests_dadata` - 🔌 проверка оставшихся запросов Dadata
- `/get_memory` - 💻 системная статистика
- `/get_logs_docker` - 🐳 логи Docker контейнеров
- `/uni_company` - 📊 анализ компаний с унифицированными названиями

### 🎨 Интерфейс

Бот предоставляет интуитивно понятный интерфейс с inline-кнопками для навигации по функциям. Все основные операции доступны через главное меню.

## 👨‍💻 Разработка

### 🔧 Структура кода

- **🐍 main.py**: Основная логика бота, обработчики команд и callback-функций
- **⚙️ __init__.py**: Конфигурация, логирование и вспомогательные функции
- **🔌 Обработчики**: Модульная структура для различных типов команд

### 📝 Логирование

Бот использует систему логирования с записью в файлы и выводом в консоль. Логи сохраняются в директории `logging/` с детальной информацией о времени, уровне и источнике.

### 🧪 Тестирование

Для тестирования рекомендуется:
1. 🤖 Использовать тестовый Telegram бот
2. 🗄️ Создать отдельную тестовую базу данных
3. 🎭 Использовать mock-данные для внешних API

## 🚀 Развертывание

### 🏭 Продакшн

1. **⚙️ Настройка production переменных**
   ```bash
   # В .env файле
   TOKEN=production_bot_token
   HOST=production_db_host
   # ... другие production настройки
   ```

2. **🚀 Запуск в production**
   ```bash
   docker-compose -f docker-compose.yml up -d
   ```

3. **📊 Мониторинг**
   ```bash
   docker-compose logs -f telegram_bot
   ```

### 🔄 Обновления

1. **⏹️ Остановка сервиса**
   ```bash
   docker-compose down
   ```

2. **📥 Обновление кода**
   ```bash
   git pull origin main
   ```

3. **🔨 Пересборка и запуск**
   ```bash
   docker-compose up --build -d
   ```

## 🔒 Безопасность

### 🛡️ Рекомендации

- 🔑 Храните токены и пароли в переменных окружения
- 🐳 Ограничьте доступ к Docker socket
- 🔐 Используйте HTTPS для внешних API
- 📦 Регулярно обновляйте зависимости
- 👤 Ограничьте доступ к боту по username

### 🚫 Ограничения доступа

Некоторые функции (например, просмотр логов Docker) доступны только определенным пользователям:

```python
if message.from_user.username in ["timurzav", "uventus8"]:
    # 🔓 Доступ к расширенным функциям
```

## 📊 Мониторинг и поддержка

### 📝 Логи

- 📁 Логи приложения: `logging/` директория
- 🐳 Docker логи: `docker-compose logs telegram_bot`
- 💻 Системные логи: через стандартные средства ОС

### 🆘 Устранение неполадок

1. **🤖 Бот не отвечает**
   - 🔑 Проверьте токен в переменных окружения
   - ✅ Убедитесь, что бот запущен
   - 📝 Проверьте логи на ошибки

2. **🗄️ Проблемы с базой данных**
   - 🌐 Проверьте доступность ClickHouse
   - 👤 Убедитесь в правильности учетных данных
   - 🔌 Проверьте сетевые настройки

3. **🐳 Ошибки Docker**
   - 🔐 Проверьте права доступа к Docker socket
   - 🚀 Убедитесь в запущенном Docker daemon
   - ⚙️ Проверьте конфигурацию docker-compose

## 🤝 Вклад в проект

### 🚀 Как помочь

1. 🍴 Форкните репозиторий
2. 🌿 Создайте feature branch
3. ✏️ Внесите изменения
4. 🔄 Создайте Pull Request

### 📋 Стандарты кода

- 🐍 Следуйте PEP 8 для Python кода
- 💬 Добавляйте комментарии к сложной логике
- 📚 Обновляйте документацию при изменении API
- 🧪 Пишите тесты для новых функций

## 📄 Лицензия

[Укажите тип лицензии]

## 📞 Контакты

- 👤 Автор: [Ваше имя]
- 📧 Email: [ваш_email]
- 🤖 Telegram: [ваш_username]

## 📈 История изменений

### 🎉 v1.0.0
- 🚀 Базовая функциональность мониторинга
- 🔌 Интеграция с ClickHouse, Dadata, XML River
- 🐳 Docker контейнеризация
- 📝 Система логирования
